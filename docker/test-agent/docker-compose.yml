version: '3.8'

services:
  test-agent:
    build: .
    container_name: clawmud-test-agent
    environment:
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}
      - MUD_HOST=${MUD_HOST:-host.docker.internal}
      - MUD_PORT=${MUD_PORT:-4000}
      - LOGS_DIR=/agent/logs
    volumes:
      - ./data/logs:/agent/logs
    extra_hosts:
      - "host.docker.internal:host-gateway"
    depends_on:
      - log-viewer

  # Web log viewer - streams logs in real-time
  log-viewer:
    build: ./log-viewer
    container_name: clawmud-log-viewer
    ports:
      - "4400:4400"
    volumes:
      - ./data/logs:/agent/logs:ro
    environment:
      - LOGS_DIR=/agent/logs
    restart: unless-stopped

  # Optional: Run multiple test agents
  test-agent-2:
    build: .
    container_name: clawmud-test-agent-2
    profiles: ["multi"]
    environment:
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}
      - MUD_HOST=${MUD_HOST:-host.docker.internal}
      - MUD_PORT=${MUD_PORT:-4000}
    extra_hosts:
      - "host.docker.internal:host-gateway"
    stdin_open: true
    tty: true
