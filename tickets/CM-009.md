# CM-009: Combat System Design

**Type:** feature  
**Priority:** high  
**Status:** Done  

## Summary
Design and implement a cyberpunk combat system supporting guns, melee weapons (swords, hammers, knives), and cyberware-enhanced combat.

## Requirements

### Weapon Categories
- **Ranged:** Pistols, SMGs, rifles, shotguns, heavy weapons
- **Melee:** Blades (katanas, knives), blunt (hammers, bats, fists)
- **Cyberware:** Mantis blades, gorilla arms, projectile launchers
- **Tech:** EMP grenades, netrunner attacks (for PvE)

### Core Mechanics Needed
- [x] Attack/defense rolls
- [x] Damage types (physical, electrical, EMP)
- [x] Range system (melee vs ranged)
- [x] Cover mechanics
- [x] Armor/damage reduction
- [x] Critical hits
- [x] Status effects (bleeding, stunned, hacked)

### Integration Points
- Character stats (reflexes, body, tech, cool)
- Cyberware bonuses (CM-010)
- Level scaling
- NPC combat AI

## Design Document
See: `/docs/design/combat.md`

## Acceptance Criteria
- [x] Combat design doc complete with all mechanics
- [x] Weapon stat templates defined
- [x] Damage formulas documented
- [x] Implementation plan with Python code structure
- [ ] Reviewed and approved

## Implementation (Completed 2025-01-14)

### Python Modules Created
- `src/combat.py` - Core combat engine with turn-based combat, attack resolution, crits, status effects
- `src/weapons.py` - Weapon classes, damage calculations, range modifiers, ammo tracking
- `src/armor.py` - Armor system with SP damage reduction, degradation, equipment slots

### Data Files Created
- `data/weapons.json` - 24 weapons across all categories (pistols, SMGs, rifles, shotguns, snipers, heavy weapons, knives, swords, blunt, cyberweapons)
- `data/armor.json` - 16 armor pieces (none, light, medium, heavy, powered, subdermal cyberware, head protection)

### Key Features Implemented
- **Combat Stats:** BODY, REFLEXES, TECH, COOL with derived HP, initiative, dodge, crit threshold
- **Attack Resolution:** d20 + modifiers vs 10 + dodge + cover
- **Damage Formula:** Weapon dice + stat bonus + d6 variance, minus armor SP
- **Range Bands:** Melee → Close → Medium → Far → Extreme with weapon-specific modifiers
- **Cover System:** Light (+2), Medium (+4), Heavy (+6), Full (untargetable)
- **Critical Hits:** Natural 20 or roll >= threshold doubles dice + location table
- **Armor Degradation:** SP reduces by 1 when penetrated
- **Status Effects:** Bleeding, stunned, prone, suppressed, hacked, on fire

## Notes
- Keep it accessible for text-based play (no twitch reflexes)
- Turn-based or cooldown-based, not real-time
- Should feel cyberpunk (gritty, lethal, chrome matters)
