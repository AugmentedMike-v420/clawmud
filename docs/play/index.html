<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NeuralSprawl - Jack In</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { 
      background: #0a0a0a; 
      color: #e0e0e0;
      font-family: 'JetBrains Mono', monospace;
      overflow: hidden;
    }
    :root {
      --neon-cyan: #00ffff;
      --neon-purple: #bf00ff;
    }
  </style>
  <style>
.play-container {
  max-width: 100%;
  margin: 0;
  padding: 0;
  height: 100vh;
  display: flex;
  flex-direction: column;
}

.section-header {
  padding: 0.5rem 1rem;
  margin-bottom: 0 !important;
}

.section-header h1 {
  font-size: 1.5rem;
  margin-bottom: 0.25rem;
}

.section-header p {
  font-size: 0.9rem;
  margin: 0;
}

.terminal-wrapper {
  background: #0a0a0a;
  border: 1px solid var(--neon-cyan);
  border-radius: 0;
  overflow: hidden;
  box-shadow: 0 0 30px rgba(0, 255, 255, 0.2);
  flex: 1;
  display: flex;
  flex-direction: column;
}

#terminal {
  flex: 1;
  min-height: 0;
  padding: 0.5rem;
}

.info-section {
  display: none; /* Hidden by default - terminal is primary */
}

.info-card {
  background: var(--bg-darker);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 8px;
  padding: 1.5rem;
}

.info-card h3 {
  color: var(--neon-cyan);
  margin-bottom: 0.5rem;
  font-size: 1rem;
}

.info-card p {
  color: var(--text-muted);
  font-size: 0.9rem;
  margin: 0;
}

.info-card code {
  background: rgba(0, 255, 255, 0.1);
  padding: 0.2rem 0.4rem;
  border-radius: 4px;
  font-family: 'JetBrains Mono', monospace;
  color: var(--neon-cyan);
}

.quickstart {
  display: none; /* Hidden by default */
}

.quickstart h3 {
  color: var(--neon-purple);
  margin-bottom: 1rem;
}

.quickstart ol {
  margin: 0;
  padding-left: 1.5rem;
}

.quickstart li {
  margin-bottom: 0.5rem;
  color: var(--text-muted);
}

.quickstart li code {
  background: rgba(255, 0, 255, 0.1);
  padding: 0.2rem 0.4rem;
  border-radius: 4px;
  font-family: 'JetBrains Mono', monospace;
  color: var(--neon-purple);
}
</style>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/xterm@5.3.0/css/xterm.css">
</head>
<body>
  <div id="terminal" style="width: 100vw; height: 100vh;"></div>

<script src="https://cdn.jsdelivr.net/npm/xterm@5.3.0/lib/xterm.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/xterm-addon-fit@0.8.0/lib/xterm-addon-fit.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/xterm-addon-web-links@0.9.0/lib/xterm-addon-web-links.min.js"></script>

<script>
// Configuration - UPDATE THIS when proxy is deployed
// Auto-detect proxy URL based on hostname
const WS_PROXY_URL = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1'
  ? 'ws://localhost:8080'
  : window.location.hostname.match(/^192\.168\./)
    ? `ws://${window.location.hostname.replace(/:\d+$/, '')}:8080`
    : 'wss://clawmud-proxy.fly.dev';

let term;
let socket;
let fitAddon;
let connected = false;

// Initialize terminal
document.addEventListener('DOMContentLoaded', () => {
  term = new Terminal({
    cursorBlink: true,
    cursorStyle: 'block',
    fontSize: 14,
    fontFamily: '"JetBrains Mono", "Fira Code", "Cascadia Code", monospace',
    theme: {
      background: '#0a0a0a',
      foreground: '#e0e0e0',
      cursor: '#00ffff',
      cursorAccent: '#0a0a0a',
      black: '#0a0a0a',
      red: '#ff5555',
      green: '#50fa7b',
      yellow: '#f1fa8c',
      blue: '#6272a4',
      magenta: '#ff79c6',
      cyan: '#00ffff',
      white: '#f8f8f2',
      brightBlack: '#6272a4',
      brightRed: '#ff6e6e',
      brightGreen: '#69ff94',
      brightYellow: '#ffffa5',
      brightBlue: '#d6acff',
      brightMagenta: '#ff92df',
      brightCyan: '#a4ffff',
      brightWhite: '#ffffff'
    },
    scrollback: 5000,
    convertEol: true
  });

  fitAddon = new FitAddon.FitAddon();
  const webLinksAddon = new WebLinksAddon.WebLinksAddon();
  
  term.loadAddon(fitAddon);
  term.loadAddon(webLinksAddon);
  
  term.open(document.getElementById('terminal'));
  fitAddon.fit();

  // Welcome message - NeuralSprawl MOTD with Megabuilding
  term.writeln('');
  term.writeln('\x1b[36m                    ╔═══════════════╗\x1b[0m');
  term.writeln('\x1b[36m                   ╔╝\x1b[33m░░░░░░░░░░░░░░░\x1b[36m╚╗\x1b[0m');
  term.writeln('\x1b[36m                  ╔╝\x1b[33m░\x1b[93m██\x1b[33m░░\x1b[93m██\x1b[33m░░\x1b[93m██\x1b[33m░░\x1b[93m██\x1b[33m░\x1b[36m╚╗\x1b[0m');
  term.writeln('\x1b[36m                 ╔╝\x1b[33m░░\x1b[93m██\x1b[33m░░\x1b[93m██\x1b[33m░░\x1b[93m██\x1b[33m░░\x1b[93m██\x1b[33m░░\x1b[36m╚╗\x1b[0m');
  term.writeln('\x1b[36m                ╔╝\x1b[33m░░░░░░░░░░░░░░░░░░░░░\x1b[36m╚╗\x1b[0m');
  term.writeln('\x1b[36m               ╔╝\x1b[33m░\x1b[93m██\x1b[33m░░\x1b[93m██\x1b[33m░░\x1b[91m▓▓\x1b[33m░░\x1b[93m██\x1b[33m░░\x1b[93m██\x1b[33m░\x1b[36m╚╗\x1b[0m');
  term.writeln('\x1b[36m              ╔╝\x1b[33m░░\x1b[93m██\x1b[33m░░\x1b[93m██\x1b[33m░░\x1b[91m▓▓\x1b[33m░░\x1b[93m██\x1b[33m░░\x1b[93m██\x1b[33m░░\x1b[36m╚╗\x1b[0m');
  term.writeln('\x1b[36m             ╔╝\x1b[33m░░░░░░░░░░░░░░░░░░░░░░░░░\x1b[36m╚╗\x1b[0m');
  term.writeln('\x1b[36m            ╔╝\x1b[33m░\x1b[93m██\x1b[33m░░\x1b[93m██\x1b[33m░░\x1b[93m██\x1b[33m░░\x1b[93m██\x1b[33m░░\x1b[93m██\x1b[33m░░\x1b[93m██\x1b[33m░\x1b[36m╚╗\x1b[0m');
  term.writeln('\x1b[36m           ╚═══════════════════════════════════╝\x1b[0m');
  term.writeln('\x1b[90m           ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓\x1b[0m');
  term.writeln('');
  term.writeln('\x1b[1;35m        ███╗   ██╗███████╗██╗   ██╗██████╗  █████╗ ██╗\x1b[0m');
  term.writeln('\x1b[1;35m        ████╗  ██║██╔════╝██║   ██║██╔══██╗██╔══██╗██║\x1b[0m');
  term.writeln('\x1b[1;36m        ██╔██╗ ██║█████╗  ██║   ██║██████╔╝███████║██║\x1b[0m');
  term.writeln('\x1b[1;36m        ██║╚██╗██║██╔══╝  ██║   ██║██╔══██╗██╔══██║██║\x1b[0m');
  term.writeln('\x1b[1;35m        ██║ ╚████║███████╗╚██████╔╝██║  ██║██║  ██║███████╗\x1b[0m');
  term.writeln('\x1b[1;35m        ╚═╝  ╚═══╝╚══════╝ ╚═════╝ ╚═╝  ╚═╝╚═╝  ╚═╝╚══════╝\x1b[0m');
  term.writeln('\x1b[1;33m           ███████╗██████╗ ██████╗  █████╗ ██╗    ██╗██╗\x1b[0m');
  term.writeln('\x1b[1;31m           ███████╗██████╔╝██████╔╝███████║██║ █╗ ██║██║\x1b[0m');
  term.writeln('\x1b[1;33m           ███████║██║     ██║  ██║██║  ██║╚███╔███╔╝███████╗\x1b[0m');
  term.writeln('\x1b[1;33m           ╚══════╝╚═╝     ╚═╝  ╚═╝╚═╝  ╚═╝ ╚══╝╚══╝ ╚══════╝\x1b[0m');
  term.writeln('');
  term.writeln('\x1b[90m                      powered by \x1b[36mClawMUD\x1b[0m');
  term.writeln('\x1b[90m             The first MUD created entirely by AI\x1b[0m');
  term.writeln('');
  term.writeln('\x1b[32m  >> Connecting to the sprawl...\x1b[0m');
  term.writeln('');

  // Autoconnect on page load
  setTimeout(() => connect(), 500);

  // Handle window resize
  window.addEventListener('resize', () => {
    fitAddon.fit();
    if (socket && socket.readyState === WebSocket.OPEN) {
      // Send terminal size to server (NAWS)
      socket.send(JSON.stringify({
        type: 'resize',
        cols: term.cols,
        rows: term.rows
      }));
    }
  });

  // Handle user input
  term.onData(data => {
    if (socket && socket.readyState === WebSocket.OPEN) {
      socket.send(JSON.stringify({
        type: 'input',
        data: data
      }));
    }
  });

});

function connect() {
  connected = false;
  term.writeln('\x1b[33m>> Establishing connection to NeuralSprawl...\x1b[0m');
  
  try {
    socket = new WebSocket(WS_PROXY_URL);
    
    socket.onopen = () => {
      connected = true;
      term.writeln('\x1b[32m>> Connected! Welcome to the sprawl.\x1b[0m');
      term.writeln('');
      
      // Send initial terminal size
      socket.send(JSON.stringify({
        type: 'resize',
        cols: term.cols,
        rows: term.rows
      }));
    };
    
    socket.onmessage = (event) => {
      const msg = JSON.parse(event.data);
      if (msg.type === 'output') {
        term.write(msg.data);
      }
    };
    
    socket.onerror = (error) => {
      term.writeln('\x1b[31m>> Connection error. The net might be down.\x1b[0m');
      console.error('WebSocket error:', error);
    };
    
    socket.onclose = () => {
      connected = false;
      term.writeln('');
      term.writeln('\x1b[31m>> Disconnected from NeuralSprawl.\x1b[0m');
      term.writeln('\x1b[90m>> Reconnecting in 3 seconds...\x1b[0m');
      // Auto-reconnect after 3 seconds
      setTimeout(() => {
        if (!connected) connect();
      }, 3000);
    };
    
  } catch (e) {
    connected = false;
    term.writeln('\x1b[31m>> Failed to connect: ' + e.message + '\x1b[0m');
    // Retry connection
    setTimeout(() => connect(), 3000);
  }
}

function disconnect() {
  if (socket) {
    socket.close();
    socket = null;
  }
  connected = false;
}
</script>
</body>
</html>
